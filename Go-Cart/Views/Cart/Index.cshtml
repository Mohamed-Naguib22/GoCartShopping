@model Cart
@{
    ViewData["Title"] = "Cart";
}


<section class="cart mx-2 ">
    <div class="container">
        <h2 class="mt-4">Phone</h2>
        <hr />
        <div class="mt-4 bg-white">
            <table class="table table-bordered table-striped ">
                <thead class="text-white " style="background-color: #41819c;">
                    <tr>
                        <th class="">Details</th>
                        <th>Price</th>
                        <th> Quantity </th>
                    </tr>
                </thead>

                <tbody class="">
                    @foreach (var item in Model.Products)
                    {
                        <tr>
                            <td>
                                <div class="d-flex justify-content-between align-items-center gap-1">
                                    <img src="@item.ImgUrl" alt="@item.Name" class="mr-2" width="50" height="50">
                                    <p class="text-black">@item.Name</p>
                                    <div class="w-25">
                                    </div>
                                </div>
                            </td>

                            <td class="pt-3">@item.Price$</td>
                            <td class=" py-4 d-flex justify-content-between align-items-center gap-1">
                                <input type="number" class="w-25 quantity-input" data-product-id="@item.Id" value="@item.Quantity" min="1" max="10" />
                                <button class="update-btn btn d-none" data-product-id="@item.Id">Update</button>

                                <div class="d-flex justify-content-center align-items-center">
                                    <button type="submit" data-product-id="@item.Id" class="btn remove-btn btn-danger">Remove</button>
                                </div>
                            </td>
                        </tr>
                    }
                    <tr>
                        <td colspan="3" class="fs-1 text-black">Total Price :@Model.TotalPrice$</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- <div class="border w-25 py-5 rounded-3 bg-opacity-10 bg-dark"><span class="fs-3 fw-bolder ms-4">Total Price:1000$</span> </div> -->
        <div class="d-flex gap-2 pt-3">
            <h4 class=""><a style="background-color: #41819c;" asp-controller="Order" asp-action="PlaceOrder" class="btn text-white ">Checkout</a></h4>
            <h4 class="mt-2 h6"><a asp-controller="Home" asp-action="Index" class="">Continue Shopping</a></h4>
        </div>
    </div>
</section>

@section scripts {
    <script>
        $(document).ready(function () {
            // AJAX request to update quantity
            $(".quantity-input").on("input", function () {
                var productId = $(this).data("product-id");
                var quantity = $(this).val();
                if (quantity > 0) {
                    updateQuantity(productId, quantity);
                }
            });

            // AJAX request to remove item
            $(".remove-btn").click(function () {
                var productId = $(this).data("product-id");
                removeFromCart(productId);
            });

            // Function to update quantity using AJAX
            function updateQuantity(productId, quantity) {
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("UpdateQuantity", "Cart")",
                    data: { productId: productId, quantity: quantity },
                    success: function () {
                        // Update the UI if needed
                        location.reload(); // Refresh the page to reflect the changes
                    },
                    error: function () {
                        // Handle error, if any
                    }
                });
            }

            // Function to remove item from cart using AJAX
            function removeFromCart(productId) {
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("RemoveFromCart", "Cart")",
                    data: { productId: productId },
                    success: function () {
                        // Update the UI if needed
                        location.reload(); // Refresh the page to reflect the changes
                    },
                    error: function () {
                        // Handle error, if any
                    }
                });
            }
        });
    </script>
}